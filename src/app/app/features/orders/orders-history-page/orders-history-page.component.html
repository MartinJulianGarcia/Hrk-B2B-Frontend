<div class="orders-page-container">
<!-- Header negro con logo y navegación -->
<div class="home-header">
  <div class="header-left">
    <div class="logo" (click)="goToCatalog()">
      <div class="logo-symbol">
        <img src="/HIRKUM-MONOGRAMA-B.jpg" alt="HIRKUM Logo" class="logo-image">
      </div>
      <span>HRK</span>
    </div>
    <nav class="main-nav">
      <a (click)="goToCatalog()" class="nav-item">SHOP</a>
      <a (click)="goToCatalog()" class="nav-item sale">SALE</a>
      <a (click)="goToInfo()" class="nav-item info">info</a>
    </nav>
  </div>
  
  <div class="header-right">
           <button class="icon-btn cart-icon" title="Carrito" (click)="goToCart()">
             🛒
             <span *ngIf="cartItemCount > 0" class="cart-badge">{{ cartItemCount }}</span>
           </button>
    <button class="icon-btn search-icon" title="Buscar" (click)="openSearchModal()">
      🔍
    </button>
    <button class="icon-btn history-btn active" title="Historial de Pedidos" (click)="goToHistory()">
      📋
    </button>
    <button class="icon-btn user-icon" title="Perfil de Usuario" (click)="goToProfile()">
      <img src="/images/user-icon.png" alt="Usuario" class="user-icon-img">
    </button>
    <button class="logout-btn" (click)="logout()" title="Cerrar Sesión">
      Cerrar Sesión
    </button>
  </div>
</div>

<!-- Contenido principal -->
<div class="orders-container">
  <h1 class="page-title">HISTORIAL DE PEDIDOS</h1>
  
  <!-- Filtro de fecha -->
  <div class="filter-section">
    <label for="fecha" class="filter-label">Fecha desde:</label>
    <input 
      type="date" 
      id="fecha" 
      [(ngModel)]="filtroFecha" 
      (change)="onFechaChange()"
      class="date-input"
      placeholder="Selecciona fecha desde"
    />
  </div>
  
  <!-- Estado de carga -->
  <div *ngIf="loading" class="loading-state">
    <p>Cargando historial de pedidos...</p>
  </div>

  <!-- Estado de error -->
  <div *ngIf="error && !loading" class="error-state">
    <p>{{ error }}</p>
    <button (click)="loadPedidos()" class="retry-btn">Reintentar</button>
  </div>

  <!-- Tabla de pedidos o mensaje de vacío -->
  <div *ngIf="!loading && !error">
    <!-- Mensaje cuando no hay pedidos -->
    <div *ngIf="pedidosFiltrados.length === 0" class="empty-state">
      <h3>Aún no hay pedidos realizados por el cliente</h3>
      <p>Cuando realices tu primer pedido, aparecerá aquí.</p>
      <button (click)="goToCatalog()" class="catalog-btn">Ir al Catálogo</button>
    </div>

    <!-- Tabla cuando hay pedidos -->
    <div *ngIf="pedidosFiltrados.length > 0" class="orders-table">
      <div class="table-header">
        <div class="header-cell">ID</div>
        <div class="header-cell">FECHA</div>
        <div class="header-cell">MONTO</div>
        <div class="header-cell">ESTADO</div>
        <div class="header-cell">TIPO</div>
        <div class="header-cell">ACCIÓN</div>
      </div>
      
      <div class="table-body">
        <div *ngFor="let pedido of pedidosFiltrados" class="table-row" [attr.data-pedido-id]="pedido.id">
          <div class="table-cell"><strong>#{{ pedido.id }}</strong></div>
          <div class="table-cell">{{ formatearFecha(pedido.fecha) }}</div>
          <div class="table-cell">{{ formatearMonto(pedido.montoTotal) }}</div>
          <div class="table-cell">
            <span [class]="getEstadoClass(pedido.estado)">{{ pedido.estado }}</span>
          </div>
          <div class="table-cell">
            <button [class]="getTipoClass(pedido.tipo)">{{ pedido.tipo }}</button>
          </div>
          <div class="table-cell">
            <button class="view-btn" (click)="verDetallePedido(pedido.id)" title="Ver Detalle">
              📋 Ver
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Botón de generar devolución -->
  <div class="actions-section">
    <button (click)="generarNotaDevolucion()" class="devolucion-btn">
      Generar nota de devolución
    </button>
  </div>
</div>

<!-- Modal de búsqueda -->
<div *ngIf="showSearchModal" class="search-modal-overlay" (click)="closeSearchModal()">
  <div class="search-modal" (click)="$event.stopPropagation()">
    <div class="search-header">
      <h3>Buscar en la página</h3>
      <button class="close-btn" (click)="closeSearchModal()">×</button>
    </div>
    <div class="search-input-container">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="performSearch()"
        placeholder="Escribe lo que quieres buscar..."
        class="search-input"
        autofocus
      >
    </div>
    <div class="search-results" *ngIf="searchResults.length > 0">
      <div class="search-result-item" 
           *ngFor="let result of searchResults" 
           (click)="scrollToResult(result)">
        <div class="result-type">{{ result.type === 'pedido' ? '📋' : '📄' }}</div>
        <div class="result-content">
          <div class="result-title">{{ result.title }}</div>
          <div class="result-description">{{ result.description }}</div>
        </div>
      </div>
    </div>
    <div class="no-results" *ngIf="searchTerm && searchResults.length === 0">
      <p>No se encontraron resultados para "{{ searchTerm }}"</p>
    </div>
  </div>
</div>
</div>
